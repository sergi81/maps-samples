<html>

<head>
  <title>OpenData</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <nav class="navbar navbar-light bg-light">
    <a target="_self" class="navbar-brand" href="index.html">
            Inicio
        </a>
    <span> Introducción a OpenData </span>
  </nav>
  <div class="container">
    <h5>Introducción a OpenaData</h5>

    <div class="alert alert-warning">
      <h5> Recursos</h5>
      <ul>
        <li><a href="http://docs.ckan.org/en/latest/api/">http://docs.ckan.org/en/latest/api/</a></li>
        <li><a href="http://ckan.org">http://ckan.org</a></li>
        <li><a href="https://www.socrata.com">https://www.socrata.com</a></li>
        <li><a href="http://docs.socratadiscovery.apiary.io">http://docs.socratadiscovery.apiary.io</a></li>
      </ul>
    </div>
    <div class="soft">
      <h5>Ejemplo API CKAN<a class="headerlink" href="#ejemplo-api-ckan" title="Permalink to this headline"></a></h5>
      <p>El API de CKAN <a class="reference external" href="http://docs.ckan.org/en/latest/api/index.html">http://docs.ckan.org/en/latest/api/index.html</a> no ofrece diferetes niveles y métodos para poder buscar y filtrar datasets.</p>
      <p>En este ejemplo utilizaremos el método <strong>resource_search</strong> <a class="reference external" href="http://docs.ckan.org/en/latest/api/index.html#ckan.logic.action.get.resource_search">http://docs.ckan.org/en/latest/api/index.html#ckan.logic.action.get.resource_search</a>        para buscar datasets en cualquier portal de CKAN</p>
      <p>Para buscar en portales CKAN necesitamos saber la URL del portal , exemplo <a class="reference external" href="http://demo.ckan.org">http://demo.ckan.org</a> y añadir el path del método a utilizar <strong>/api/3/action/resource_search?</strong></p>
      <p><a class="reference external" href="http://demo.ckan.org/api/3/action/resource_search">http://demo.ckan.org/api/3/action/resource_search</a>?</p>
      <p>Descomprimiremos el archivo <a class="reference external" href="datos/web.zip">web.zip</a> en nuestro espacio de trabajo.</p>
      <div class="section" id="creacion-de-un-buscador">
        <h5>Creación de un buscador<a class="headerlink" href="#creacion-de-un-buscador" title="Permalink to this headline"></a></h5>
        <ol class="arabic">
          <li>
            <p class="first">Dentro del directorio <strong>web</strong> creamos un archivo con el nombre de <b>ckan.html</b>.</p>
          </li>
          <li>
            <p class="first">Abrimos el archivo ckan.html con un editor de texto y copiamos el siguiente código.:</p>
            <div class="highlight-python"><pre><code class="prettyprint">
    &lt;html&gt;
    &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;
      Ejemplo Resource Search API CKAN
   &lt;/title&gt;
      &#x3C;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous"&#x3E;
   &#x3C;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"&#x3E;&#x3C;/script&#x3E;
   &#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"&#x3E;&#x3C;/script&#x3E;
   &#x3C;script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"&#x3E;&#x3C;/script&#x3E;
   &#x3C;script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"&#x3E;&#x3C;/script&#x3E;
    &lt;style&gt;
      #results {
        width: 100%;
        background-color: #f2f2f2;
        margin: 5px;
      }
    &lt;/style&gt;
        &lt;/head&gt;
        &lt;body&gt;

        &lt;/body&gt;
&lt;/html&gt;
</code></pre>
            </div>
          </li>
          <li>
            <p class="first">Abrimos el archivo ckan.html en el navegador.</p>
          </li>
          <li>
            <p class="first">Añadimos dentro del tag <em>&lt;body&gt;</em> la maquetación HTML.:</p>
            <div class="highlight-python"><pre><code class="prettyprint">&lt;div class=&quot;container&quot;&gt;
        &lt;h5&gt;Resource Search example &lt;/h5&gt;
        &lt;p&gt;     Package Search &lt;br&gt;
          &lt;a target=&quot;_blank&quot; href=&quot;http://docs.ckan.org/en/latest/api/&quot;&gt;http://docs.ckan.org/en/latest/api/&lt;/a&gt;
        &lt;/p&gt;
        &lt;form&gt;
        &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;url_ckan&quot;&gt;Url:&lt;/label&gt;

        &lt;select id=&quot;url_ckan&quot; &gt;
        &lt;option value=&quot;http://demo.ckan.org/api/3/action/resource_search?&quot;&gt;ckan.org&lt;/option&gt;
        &lt;option value=&quot;http://old.datahub.io/api/3/action/resource_search?&quot;&gt;old.datahub.io&lt;/option&gt;
        &lt;/select&gt;
        &lt;/div&gt;
        &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;text_filter_ckan&quot;&gt; Filter &lt;u&gt;(name, descripton, format )&lt;/u&gt;&lt;/label&gt;
        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;text_filter_ckan&quot; value=&quot;name:wifi&quot; placeholder=&quot;text filter&quot;&gt;
          &lt;/div&gt;
        &lt;/form&gt;
        &lt;form class=&quot;form-inline&quot;&gt;
        &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;num_results_ckan&quot;&gt;Num results&lt;/label&gt;
        &lt;input type=&quot;number&quot; size=&quot;3&quot; class=&quot;form-control&quot; id=&quot;num_results_ckan&quot; value=&quot;5&quot;&gt;
        &lt;/div&gt;

        &lt;/form&gt;
        &lt;form&gt;
        &lt;div class=&quot;form-group&quot;&gt;
        &lt;button id=&quot;bt_send&quot; type=&quot;button&quot; class=&quot;btn btn-default btn-success&quot;&gt;Send&lt;/button&gt;
        &lt;/div&gt;
        &lt;/form&gt;
        &lt;hr&gt;
        &lt;div id=&quot;results&quot;&gt;&lt;/div&gt;
        &lt;div id=&quot;mygrid&quot; style=&quot;height: 500px&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
            </div>
          </li>
          <li>
            <p class="first">Abrimos el archivo ckan.html en el navegador.</p>
          </li>
          <li>
            <p class="first">Añadimos justo encima de tag <em>&lt;/body&gt;</em> el código en JavaScript.:</p>
            <div class="highlight-python"><pre><code class="prettyprint">&lt;script&gt;
        $.ajaxSetup({
                cache: true
        });
        $(document).ready(function() {
          $(&#39;#bt_send&#39;).on(&#39;click&#39;, function() {
            var data = {
                    rows: $(&#39;#num_results_ckan&#39;).val(),
                    query: $(&#39;#text_filter_ckan&#39;).val()
            };
            $.ajax({
              url: $(&#39;#url_ckan&#39;).val(),
              data: data,
              dataType: &#39;jsonp&#39;,
              success: function(data) {
                if (data.success) {
                    $(&#39;#results&#39;).html(&#39;Total results found: &#39; + data.result.count);
                    $(&#39;#mygrid&#39;).html(&#39;&#39;);

                    if (data.result.count &gt;= 1) {
                            $(&#39;#mygrid&#39;).append(&#39;&lt;ul&gt;&#39;);
                            $.each(data.result.results, function(index, value) {
                                    $(&#39;#mygrid&#39;).append(&#39;&lt;li&gt;&#39; + value.name + &#39;: &lt;a href=&quot;&#39; + value.url + &#39;&quot;&gt;&#39; + value.url + &#39;&lt;/a&gt;&#39;);

                                    $(&#39;#mygrid&#39;).append(&#39;&lt;/li&gt;&#39;);
                            });
                            $(&#39;#mygrid&#39;).append(&#39;&lt;/ul&gt;&#39;);
                    }

                } else {
                        $(&#39;#results&#39;).html(&quot;An error occured: &quot; + data.error.message);
                }
              },
              error: function(xhr) {
                      $(&#39;#results&#39;).html(&quot;An error occured: &quot; + xhr.status + &quot; &quot; + xhr.statusText);
              }

            });

          })

        });
&lt;/script&gt;
</code></pre>
            </div>
          </li>
          <li>
            <p class="first">Abrimos pàgina ckan.html y lanzamos búsquedas</p>
          </li>
          <li>
            <p class="first"><strong>Ejercicio 1</strong>: Añadir una o más URLs de otros portales de CKAN</p>
          </li>
          <li>
            <p class="first"><strong>Ejercicio 2</strong>: ¿Cómo haríamos para qué en los resultados apareciera la fecha de creación del dato?</p>
          </li>
        </ol>
      </div>
    </div>
    <div class="section" id="ejemplos-api-socrata">
      <br>
      <h5>Ejemplos API SOCRATA<a class="headerlink" href="#ejemplos-api-socrata" title="Permalink to this headline"></a></h5>
      <p>El API de Socrata <a class="reference external" href="https://dev.socrata.com">https://dev.socrata.com</a> no ofrece diferetes niveles y métodos para poder buscar y filtra datasets.</p>
      <p>En este primer ejemplo utilizaremos la <strong>Discovery API</strong> <a class="reference external" href="https://socratadiscovery.docs.apiary.io/">https://socratadiscovery.docs.apiary.io/</a> para buscar datasets en cualquier portal de Socrata</p>

      <div class="section" id="id1">
        <h5>1.Creación de un buscador<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h5>
        <ol class="arabic">
          <li>
            <p class="first">Dentro del directorio <strong>web</strong> creamos un archivo con el nombre de <strong>socrata.html</strong>.</p>
          </li>
          <li>
            <p class="first">Abrimos el archivo socrata.html con un editor de texto y copiamos el siguiente código.:</p>
            <div class="highlight-python"><pre><code class="prettyprint">
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;title&gt;
    Basic sample API Discovery SOCRATA
  &lt;/title&gt;
  &#x3C;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous"&#x3E;
   &#x3C;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"&#x3E;&#x3C;/script&#x3E;
   &#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"&#x3E;&#x3C;/script&#x3E;
   &#x3C;script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"&#x3E;&#x3C;/script&#x3E;
   &#x3C;script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"&#x3E;&#x3C;/script&#x3E;

  &lt;style&gt;
    #results {
      width: 100%;
      background-color: #f2f2f2;
      margin: 5px;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;


&lt;/body&gt;
&lt;/html&gt;
</code></pre>
            </div>
          </li>
          <li>
            <p class="first">Abrimos el archivo socrata.html en el navegador.</p>
          </li>
          <li>
            <p class="first">Añadimos dentro del tag <strong>&lt;body&gt;</strong> la maquetación HTML.:</p>
            <div class="highlight-python"><pre><code class="prettyprint">    &lt;div class=&quot;container&quot;&gt;
  &lt;h5&gt;SOCRATA Resource Search example &lt;/h5&gt;
  &lt;p&gt;Discovery API &lt;br&gt;
    &lt;a target=&quot;_blank&quot; href=&quot;http://docs.socratadiscovery.apiary.io&quot;&gt;http://docs.socratadiscovery.apiary.io&lt;/a&gt;
  &lt;/p&gt;
  &lt;form&gt;
    &lt;div class=&quot;form-group&quot;&gt;
      &lt;div class=&quot;radio&quot;&gt;
    &lt;label&gt;
    &lt;input type=&quot;radio&quot; name=&quot;optionsRadios&quot; id=&quot;optionsRadios1&quot; value=&quot;https://api.eu.socrata.com/api/catalog/v1&quot; checked&gt;
    EU API Discovery
      &lt;/label&gt;
      &lt;/div&gt;
      &lt;div class=&quot;radio&quot;&gt;
        &lt;label&gt;
      &lt;input type=&quot;radio&quot; name=&quot;optionsRadios&quot; id=&quot;optionsRadios2&quot; value=&quot;https://api.us.socrata.com/api/catalog/v1&quot;&gt;
      US API Discovery
        &lt;/label&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form-group&quot;&gt;
      &lt;label for=&quot;text_filter_socrata&quot;&gt; Filter &lt;u&gt;&lt;/u&gt;&lt;/label&gt;
      &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;text_filter_socrata&quot; value=&quot;Contracts&quot; placeholder=&quot;text filter&quot;&gt;
    &lt;/div&gt;
  &lt;/form&gt;
  &lt;form class=&quot;form-inline&quot;&gt;
    &lt;div class=&quot;form-group&quot;&gt;
      &lt;label for=&quot;num_results_socrata&quot;&gt;Num results&lt;/label&gt;
      &lt;input type=&quot;number&quot; size=&quot;3&quot; class=&quot;form-control&quot; id=&quot;num_results_socrata&quot; value=&quot;25&quot;&gt;
    &lt;/div&gt;

  &lt;/form&gt;
  &lt;form&gt;
    &lt;div class=&quot;form-group&quot;&gt;
      &lt;button id=&quot;bt_send&quot; type=&quot;button&quot; class=&quot;btn btn-default btn-success&quot;&gt;Send&lt;/button&gt;
    &lt;/div&gt;
  &lt;/form&gt;
  &lt;hr&gt;
  &lt;div id=&quot;results&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;mygrid&quot; style=&quot;height: 500px&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
</code></pre>
            </div>
          </li>
          <li>
            <p class="first">Abrimos el archivo <strong>socrata.html</strong> en el navegador.</p>
          </li>
          <li>
            <p class="first">Añadimos justo encima de tag <strong>&lt;/body&gt;</strong> el código en JavaScript.:</p>
            <div class="highlight-python"><pre><code class="prettyprint">      &lt;script&gt;
  $.ajaxSetup({
    cache: true
  });
  $(document).ready(function() {
    $(&#39;#bt_send&#39;).on(&#39;click&#39;, function() {
      sendRequest();
    });

    $(&#39;#text_filter_socrata&#39;).on(&#39;keypress&#39;, function(event) {
      if (event.which == 13) {
        sendRequest();
        event.preventDefault();
      }
    });

    function sendRequest() {
      var _data = {
        q: $(&#39;#text_filter_socrata&#39;).val(),
        limit: $(&#39;#num_results_socrata&#39;).val()
      };
      $.ajax({
        url: $(&#39;input:radio[name=optionsRadios]:checked&#39;).val(),
        data: _data,
        method: &#39;GET&#39;,
        dataType: &#39;json&#39;,
        success: function(data) {
          console.info(data);
          if (data) {
            $(&#39;#results&#39;).html(&#39;Total results found: &#39; + data.resultSetSize);
            $(&#39;#mygrid&#39;).html(&#39;&#39;);

            if (data.resultSetSize &gt;= 1) {
              $(&#39;#mygrid&#39;).append(&#39;&lt;ul&gt;&#39;);
              $.each(data.results, function(index, value) {
                $(&#39;#mygrid&#39;).append(&#39;&lt;li&gt;&lt;b&gt;&#39; + value.resource.name + &#39;&lt;/b&gt;(&#39; + value.resource.type + &#39;): &lt;a target=&quot;_blank&quot; href=&quot;&#39; + value.link + &#39;&quot;&gt;&#39; + value.link + &#39;&lt;/a&gt;&#39;);
                $(&#39;#mygrid&#39;).append(&#39;&lt;/li&gt;&#39;);
              });
              $(&#39;#mygrid&#39;).append(&#39;&lt;/ul&gt;&#39;);
            }
          } else {
            $(&#39;#results&#39;).html(&quot;An error occured:&quot;);
          }
        },
        error: function(xhr) {
          $(&#39;#results&#39;).html(&quot;An error occured: &quot; + xhr.status + &quot; &quot; + xhr.statusText);
        }
      });
    }
  });
&lt;/script&gt;
</code></pre>
            </div>
          </li>
          <li>
            <p class="first">Abrimos pàgina socrata.html y lanzamos búsquedas</p>
          </li>
          <li>
            <p class="first"><strong>Ejercicio 1</strong>: ¿Cómo filtraríamos para qué sólo enseñara &#8220;assets&#8221; de tipo mapa?</p>
          </li>
        </ol>
      </div>
      <div class="section" id="creacion-de-un-mapa-para-ver-resultados-de-socrata">
        <h5>2.Creación de un mapa para ver resultados de Socrata<a class="headerlink" href="#creacion-de-un-mapa-para-ver-resultados-de-socrata" title="Permalink to this headline"></a></h5>
        <ol class="arabic">
          <li>
            <p class="first">Dentro del directorio <strong>web</strong> creamos un archivo con el nombre de <strong>socrata_mapa.html</strong>.</p>
          </li>
          <li>
            <p class="first">Abrimos el archivo socrata_mapa.html con un editor de texto y copiamos el siguiente código.:</p>
            <div class="highlight-python"><pre><code class="prettyprint">
    &lt;html&gt;
    &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;
        Basic Leaflet Map sample API Discovery SOCRATA
    &lt;/title&gt;
    &#x3C;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous"&#x3E;
     &#x3C;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"&#x3E;&#x3C;/script&#x3E;
     &#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"&#x3E;&#x3C;/script&#x3E;
     &#x3C;script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"&#x3E;&#x3C;/script&#x3E;
     &#x3C;script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"&#x3E;&#x3C;/script&#x3E;
     &#x3C;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" /&#x3E;
     &#x3C;script&#x3E;
       L_PREFER_CANVAS = true;
     &#x3C;/script&#x3E;
     &#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"&#x3E;&#x3C;/script&#x3E;
     &#x3C;script src="https://calvinmetcalf.github.io/leaflet-ajax/dist/leaflet.ajax.js"&#x3E;&#x3C;/script&#x3E;
     &#x3C;script src="http://makinacorpus.github.io/Leaflet.Spin/spin/dist/spin.min.js"&#x3E;&#x3C;/script&#x3E;
     &#x3C;script src="http://makinacorpus.github.io/Leaflet.Spin/leaflet.spin.min.js"&#x3E;&#x3C;/script&#x3E;
    &lt;style&gt;
        #results {
            width: 100%;
            background-color: #f2f2f2;
            margin: 5px;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
            </div>
          </li>
          <li>
            <p class="first">Abrimos el archivo socrata_mapa.html en el navegador.</p>
          </li>
          <li>
            <p class="first">Añadimos dentro del tag <strong>&lt;body&gt;</strong> la maquetación HTML.:</p>
            <div class="highlight-python"><pre><code class="prettyprint">    &lt;div class=&quot;container&quot;&gt;
  &lt;h5&gt;SOCRATA Maps Resources &lt;/h5&gt;
  &lt;div class=&quot;row&quot;&gt;
      &lt;div class=&quot;col-md-6&quot;&gt;
    &lt;p&gt;Discovery API &lt;br&gt;
        &lt;a target=&quot;_blank&quot; href=&quot;http://docs.socratadiscovery.apiary.io&quot;&gt;http://docs.socratadiscovery.apiary.io&lt;/a&gt;
    &lt;/p&gt;
&lt;form&gt;
&lt;div class=&quot;form-group&quot;&gt;
&lt;div class=&quot;radio&quot;&gt;
    &lt;label&gt;
  &lt;input type=&quot;radio&quot; name=&quot;optionsRadios&quot; id=&quot;optionsRadios1&quot; value=&quot;https://api.eu.socrata.com/api/catalog/v1&quot; checked&gt;
  EU API Discovery
  &lt;/label&gt;
    &lt;/div&gt;
    &lt;div class=&quot;radio&quot;&gt;
        &lt;label&gt;
      &lt;input type=&quot;radio&quot; name=&quot;optionsRadios&quot; id=&quot;optionsRadios2&quot; value=&quot;https://api.us.socrata.com/api/catalog/v1&quot;&gt;
       US API Discovery
      &lt;/label&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form-group&quot;&gt;
    &lt;label for=&quot;text_filter_socrata&quot;&gt; Filter &lt;u&gt;&lt;/u&gt;&lt;/label&gt;
    &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;text_filter_socrata&quot; value=&quot;&quot; placeholder=&quot;text filter&quot;&gt;

    &lt;div class=&quot;checkbox&quot;&gt;
        &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;chk_transparencia&quot; value=&quot;analisi.transparenciacatalunya.cat&quot; &gt;Only https://analisi.transparenciacatalunya.cat&lt;/label&gt;
    &lt;/div&gt;
    &lt;div&gt; Filter : only=maps&lt;/div&gt;
    &lt;/div&gt;

    &lt;/form&gt;
    &lt;form class=&quot;form-inline&quot;&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;label for=&quot;num_results_socrata&quot;&gt;Num results&lt;/label&gt;
        &lt;input type=&quot;number&quot; size=&quot;3&quot; class=&quot;form-control&quot; id=&quot;num_results_socrata&quot; value=&quot;25&quot;&gt;
    &lt;/div&gt;

    &lt;/form&gt;
    &lt;form&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;button id=&quot;bt_send&quot; type=&quot;button&quot; class=&quot;btn btn-default btn-success&quot;&gt;Send&lt;/button&gt;
    &lt;/div&gt;
    &lt;/form&gt;
    &lt;hr&gt;
    &lt;div id=&quot;results&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;mygrid&quot; style=&quot;height: 365px;overflow:auto&quot;&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;col-md-6&quot;&gt;
        &lt;div id=&quot;map&quot; style=&quot;width:100%;height:700px&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;/div&gt;
</code></pre>
            </div>
          </li>
          <li>
            <p class="first">Abrimos el archivo socrata_mapa.html en el navegador.</p>
          </li>
          <li>
            <p class="first">Añadimos justo encima de tag <strong>&lt;/body&gt;</strong> el código en JavaScript.:</p>
            <div class="highlight-python"><pre><code class="prettyprint">&lt;script&gt;
        $.ajaxSetup({
                        cache: true
        });
        var map;
        var geojsonLayer;
        var _LL;
        $(document).ready(function() {
                map = L.map(&#39;map&#39;).setView([41.6863, 1.8382], 8);
                esri = L.tileLayer(
                        &#39;http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}&#39;, {
                                        maxZoom: 17,
                                        minZoom: 1,
                                        attribution: &#39;Tiles © Esri&#39;,
                        })

                osm = L.tileLayer(&#39;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;, {
                        maxZoom: 19,
                        minZoom: 1,
                        attribution: &#39;OSM&#39;
                }).addTo(map);

                Stamen_Toner = L.tileLayer(&#39;http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png&#39;, {
                        attribution: &#39;Map tiles by &lt;a href=&quot;http://stamen.com&quot;&gt;Stamen Design&lt;/a&gt;, &lt;a href=&quot;http://creativecommons.org/licenses/by/3.0&quot;&gt;CC BY 3.0&lt;/a&gt; &amp;mdash; Map data &amp;copy; &lt;a href=&quot;http://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt;&#39;,
                        subdomains: &#39;abcd&#39;,
                        minZoom: 0,
                        maxZoom: 20
                })

                var baseMaps = {
                        &quot;Orto&quot;: esri,
                        &quot;Mapa&quot;: osm,
                        &quot;Toner&quot;: Stamen_Toner
                };

                L.control.layers(baseMaps, null).addTo(map);
                L.control.scale().addTo(map);


                $(&#39;#bt_send&#39;).on(&#39;click&#39;, function() {
                        sendRequest();
                });

                $(&#39;#text_filter_socrata&#39;).on(&#39;keypress&#39;, function(event) {
                        if (event.which == 13) {
                                        sendRequest();
                                        event.preventDefault();
                        }
                });

                $(document).on(&#39;click&#39;, &#39;.btn-xs&#39;, function() {

              var attr = $(this).attr(&#39;data&#39;);
              if (attr &amp;&amp; attr.indexOf(&#39;#&#39;) != -1) {
                var params = attr.split(&quot;#&quot;);
                var _url = &#39;https://&#39; + params[1] + &#39;/api/views.json?method=getByResourceName&amp;name=&#39; + params[0];
                $.ajax({
                  url: _url,
                  method: &#39;GET&#39;,
                  dataType: &#39;json&#39;,
                  success: function(data) {

                    if (data.childViews) {
                      //var _url2 = &#39;https://&#39; + params[1] + &#39;/resource/&#39; + data.childViews[0] + &#39;.json?$limit=30&#39;;
                      var _url2 = &#39;https://&#39; + params[1] + &#39;/api/geospatial/&#39; + data.childViews[0] + &#39;?method=export&amp;format=GeoJSON&#39;;
                      sendRequestGEOJSON(_url2, true);
                    } else {
                        var _url2 = &#39;http://&#39; + params[1] + &#39;/resource/&#39; + params[0] + &#39;.json?$limit=30&#39;;
                        sendRequestGEOJSON(_url2, false);
                    }
                  },
                  error: function(xhr) {
                    $(&#39;#results&#39;).html(&quot;An error occured: &quot; + xhr.status + &quot; &quot; + xhr.statusText);
                  }

                });

                        } else {
                                        alert(&quot;No resource available&quot;);
                        }
                });

                function clearLayers() {
                        if (map.hasLayer(geojsonLayer)) {
                                        map.removeLayer(geojsonLayer);
                        };
                        if (map.hasLayer(_LL)) {
                                        map.removeLayer(_LL);
                        };
                }

                function sendRequestGEOJSON(_url2, isGeoJson) {
                        map.spin(true);
                        var stylePoint = {
                                radius: 8,
                                fillColor: &quot;#ff7800&quot;,
                                color: &quot;#000&quot;,
                                weight: 1,
                                opacity: 1,
                                fillOpacity: 0.8
                        };
                        clearLayers();
                        $.ajax({
                                type: &quot;GET&quot;,
                                url: _url2,
                                // jsonp: &quot;$jsonp&quot;,
                                //  dataType: &quot;jsonp&quot;,
                                success: function(response) {
                                        if (isGeoJson) {

                                                geojsonLayer = L.geoJson(response, {
                                                        style: function(feature) {
                                                                return {
                                                                        weight: 2,
                                                                        color: &quot;#999&quot;,
                                                                        opacity: 1,
                                                                        fillColor: &quot;#B0DE5C&quot;,
                                                                        fillOpacity: 0.8
                                                                };
                                                        },

                                                        onEachFeature: popUp
                                                }).addTo(map);
                                                map.fitBounds(geojsonLayer.getBounds());
                                                map.spin(false);
                                        } else {
                                                _LL = L.featureGroup()

                                                for (var i = 0; i &lt; response.length; i++) {
                                                        var marker = response[i];

                                                        if (response[i].location_1) {
                                                                L.circleMarker([response[i].location_1.latitude, response[i].location_1.longitude], stylePoint).addTo(_LL);
                                                        } else if (response[i].location) {
                                                                L.circleMarker([response[i].location.latitude, response[i].location.longitude], stylePoint).addTo(_LL);
                                                        } else {
                                                                $(&#39;#results&#39;).html(&quot;ERROR no locations found&quot;);
                                                                map.spin(false);

                                                        }
                                                }

                                                _LL.addTo(map);
                                                map.panTo(_LL.getBounds().getCenter());
                                                map.spin(false);

                                        }
                                },
                                error: function(xhr) {
                                        $(&#39;#results&#39;).html(&quot;An error occured: &quot; + xhr.status + &quot; &quot; + xhr.statusText);
                                        map.spin(false);
                                }
                        });
                }

                function popUp(f, l) {
                                var out = [];
                                if (f.properties) {
                                        for (key in f.properties) {
                                                        out.push(key + &quot;: &quot; + f.properties[key]);
                                        }
                                        l.bindPopup(out.join(&quot;&lt;br /&gt;&quot;));
                                }
                }

                function sendRequest() {
                        var _data = {
                                limit: $(&#39;#num_results_socrata&#39;).val(),
                                only: &#39;maps&#39;
                        };
                        console.info($(&#39;#chk_transparencia&#39;).attr(&#39;checked&#39;));
                        if ($(&#39;#chk_transparencia&#39;).attr(&#39;checked&#39;)) {
                                _data.domains = $(&#39;#chk_transparencia&#39;).val();
                        }
                        if ($(&#39;#text_filter_socrata&#39;).val() != &quot;&quot;) {
                                _data.q = $(&#39;#text_filter_socrata&#39;).val();
                        }

                        $.ajax({
                                url: $(&#39;input:radio[name=optionsRadios]:checked&#39;).val(),
                                data: _data,
                                method: &#39;GET&#39;,
                                dataType: &#39;json&#39;,
                                success: function(data) {
                                        console.info(data);
                                        if (data) {
                                                $(&#39;#results&#39;).html(&#39;Total results found: &#39; + data.resultSetSize);
                                                $(&#39;#mygrid&#39;).html(&#39;&#39;);

                                                if (data.resultSetSize &gt;= 1) {
                                                        var cList = $(&#39;&lt;ul&gt;&#39;).appendTo(&#39;#mygrid&#39;);
                                                        $.each(data.results, function(index, value) {
                                                                $(&#39;&lt;li class=&quot;li&quot;&gt;&lt;b&gt;&#39; + value.resource.name + &#39;: &lt;/b&gt;&#39; +
                                                                        &#39;&lt;a target=&quot;_blank&quot; href=&quot;&#39; + value.link + &#39;&quot;&gt; Link &lt;/a&gt; &#39; +
                                                                        &#39;&lt;a class=&quot;btn btn-success btn-xs&quot;  href=&quot;#&quot; data=&quot;&#39; + value.resource.id + &#39;#&#39; + value.metadata.domain + &#39;&quot;&gt;Map it&lt;/a&gt;&#39;).appendTo(cList);

                                                        });
                                                }

                                        } else {
                                                console.info(data);
                                                $(&#39;#results&#39;).html(&quot;An error occured:&quot;);
                                        }
                                },
                                error: function(xhr) {
                                        $(&#39;#results&#39;).html(&quot;An error occured: &quot; + xhr.status + &quot; &quot; + xhr.statusText);
                                }
                        });
                }
        });
&lt;/script&gt;
</code></pre>
            </div>
          </li>
          <li>
            <p class="first">Abrimos pàgina socrat_mapa.html y lanzamos búsquedas</p>
          </li>
          <li>
            <p class="first"><strong>Ejercicio 1</strong>: Añadimos <strong>attribution</strong> y <strong>download_count</strong> a los resultados</p>
          </li>
          <li>
            <p class="first"><strong>Ejercicio 2</strong>: ¿Cambiamos colores y estilos de los puntos del mapa?</p>
          </li>
        </ol>

      </div>
      <!--end container -->
    </div>
    <script>
    </script>
</body>

</html>
